---
# The bare domain name which represents your Matrix identity.
# Matrix user IDs for your server will be of the form (`@alice:example.com`).
#
# Note: this playbook does not touch the server referenced here.
# Installation happens on another server ("matrix.example.com", see `matrix_server_fqn_matrix`).
#
# If you've deployed using the wrong domain, you'll have to run the Uninstalling step,
# because you can't change the Domain after deployment.
matrix_domain: test.local

# The Matrix homeserver software to install.
# See:
#  - `roles/custom/matrix-base/defaults/main.yml` for valid options
#  - the `docs/configuring-playbook-IMPLEMENTATION_NAME.md` documentation page, if one is available for your implementation choice
#
# By default, we use Synapse, because it's the only full-featured Matrix server at the moment.
#
# Note that the homeserver implementation of a server will not be able to be changed without data loss.
matrix_homeserver_implementation: synapse

# A secret used as a base, for generating various other secrets.
# You can put any string here, but generating a strong one is preferred. You can create one with a command like `pwgen -s 64 1`.
matrix_homeserver_generic_secret_key: 4DjgiCxIoJeZsFN2iZsbKBLBfVsYP7J23Zkey42comJ4edtu7nb0ECvROHAIkSYk

# By default, the playbook manages its own Traefik (https://doc.traefik.io/traefik/) reverse-proxy server.
# It will retrieve SSL certificates for you on-demand and forward requests to all other components.
# For alternatives, see `docs/configuring-playbook-own-webserver.md`.
#
# DISABLED: Using external nginx instead to bypass Traefik HTTP/2 URL encoding issues
matrix_playbook_reverse_proxy_type: none

# Expose Synapse directly for nginx to proxy to
matrix_synapse_container_client_api_host_bind_port: '127.0.0.1:8008'
matrix_synapse_container_federation_api_plain_host_bind_port: '127.0.0.1:8048'

# Expose Element directly
matrix_client_element_container_http_host_bind_port: '127.0.0.1:8765'

# Since we're not using Traefik, we need to handle SSL externally (nginx does this)
matrix_playbook_ssl_enabled: true

# Enable Admin account creation to allow for managing rooms like deleting them
matrix_synapse_admin_enabled: true

# Expose Synapse Admin directly for nginx to proxy to
matrix_synapse_admin_container_http_host_bind_port: '127.0.0.1:8766'

# Controls whether container networks will be created with IPv6 support.
#
# If you also have IPv6 support on your server/network and AAAA DNS records pointing to the server,
# enabling this will effectively give you full public IPv6 connectivity (powered by NAT66).
#
# We recommend leaving this enabled even if you don't currently have IPv6 connectivity on your server/network.
# This way, once you eventually get IPv6 connectivity, you won't have to change anything (besides DNS records).
#
# Flipping this setting later on requires manual work (stopping services, deleting and recreating all container networks).
#
# In the future, this setting will likely default to `true`, so if you really want IPv6 disabled, explicitly set this to `false`.
#
# People managing Docker themselves and running an older Docker version will need additional configuration.
#
# Learn more in `docs/configuring-ipv6.md`.
devture_systemd_docker_base_ipv6_enabled: true

# A Postgres password to use for the superuser Postgres user (called `matrix` by default).
#
# The playbook creates additional Postgres users and databases (one for each enabled service) using this superuser account.
#
# Changing this value subsequently requires manual work.
# The value used here must be shorter than 100 characters.
postgres_connection_password: e1DWeID1pHjUpbBRnT9BKREX4F8GIgJfc1hMTKvZMT90uFlBQ1ZSfMd4Y8oliKgF

# By default, we configure coturn's external IP address using the value specified for `ansible_host` in your `inventory/hosts` file.
# If this value is an external IP address, you can skip this section.
#
# If `ansible_host` is not the server's external IP address, you have 2 choices:
# 1. Uncomment the line below, to allow IP address auto-detection to happen (more on this below)
# 2. Uncomment and adjust the line below to specify an IP address manually
#
# By default, auto-detection will be attempted using the `https://ifconfig.co/json` API.
# Default values for this are specified in `matrix_coturn_turn_external_ip_address_auto_detection_*` variables in the coturn role
# (see `roles/custom/matrix-coturn/defaults/main.yml`).
#
# If your server has multiple IP addresses, you may define them in another variable which allows a list of addresses.
# Example: `matrix_coturn_turn_external_ip_addresses: ['1.2.3.4', '4.5.6.7']`
#
# matrix_coturn_turn_external_ip_address: ''

# Disable coturn (TURN/STUN server) - not needed for text-only chat
matrix_coturn_enabled: false

# Host Element on separate domain
matrix_client_element_enabled: true
matrix_client_element_hostname: "element.test.local"

# Enable user registration for self-signup
matrix_synapse_enable_registration: true
matrix_synapse_enable_registration_without_verification: true

# Optional: Require email verification for registration (recommended for production)
# matrix_synapse_registrations_require_3pid: email

# Optional: Enable registration with reCAPTCHA to prevent spam
# matrix_synapse_enable_registration_captcha: true
# matrix_synapse_recaptcha_public_key: ""
# matrix_synapse_recaptcha_private_key: ""

# Configure web client location and CORS for separate domain
matrix_synapse_configuration_extension_yaml: |
  web_client_location: https://element.test.local
  serve_server_wellknown: true

# Upload mkcert certificates to /matrix/ssl/ for nginx to use
# Since we're not using Traefik, we create our own SSL directory
aux_directory_definitions:
  - dest: /matrix/ssl
    mode: '0755'

aux_file_definitions:
  - dest: "/matrix/ssl/cert.pem"
    content: "{{ lookup('file', playbook_dir + '/ssl-certs/matrix.test.local+2.pem') }}"
    mode: '0644'
  - dest: "/matrix/ssl/privkey.pem"
    content: "{{ lookup('file', playbook_dir + '/ssl-certs/matrix.test.local+2-key.pem') }}"
    mode: '0600'
